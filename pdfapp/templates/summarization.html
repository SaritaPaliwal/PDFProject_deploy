{% extends "navbar.html" %}
{% load static %}

{% block title %}Summarize PDFhub{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/upload1.css' %}">
<link rel="stylesheet" href="{% static 'css/loading.css' %}">
<link rel="stylesheet" href="{% static 'css/summarization.css' %}">
<br><br>
<h1>Summarize PDF</h1>
<br>
<p>Upload a PDF and the summarize content</p>
<br><br><br>
<form id="summaryForm" method="POST" enctype="multipart/form-data">
  {% csrf_token %}
  
  <div id="uploadSection"{% if summary %}style="display: none;"{% endif %}>
    <div class="container">
      <div class="folder">
        <div class="front-side">
          <div class="tip"></div>
          <div class="cover"></div>
        </div>
        <div class="back-side cover"></div>
      </div>

      <label class="custom-file-upload">
        <input id="pdfInput" type="file" accept="application/pdf" name="pdf_file" required />
        Choose a file
      </label>
    </div>

    <div id="loading" class="loader" style="display: none;">Loading...</div>
    <div id="pdfPreviewContainer" class="mt-4"></div>

    <div style="text-align: center;">
      <button type="submit" class="submit-btn" id="mergeBtn">Summarize</button>
    </div>  </div>
</form>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="{% static 'js/upload.js' %}" defer></script>

<br><br>
{% if summary %}
<div class="summary-container mt-4">
  <h3>Summary:</h3>
  <textarea class="summary-textarea" readonly>{{ summary }}</textarea>
</div>
{% endif %}

{% if messages %}
  <div class="message-container">
    {% for message in messages %}
      <div class="alert {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}

<script>
  // Add an event listener to the form
  const summaryForm = document.getElementById('summaryForm');
  const uploadSection = document.getElementById('uploadSection');
  const loadingIndicator = document.getElementById('loading');

  summaryForm.addEventListener('submit', (event) => {
    // Prevent the default form submission behavior
    event.preventDefault();

    // Hide the upload section
    uploadSection.style.display = 'none';

    // Show the loading indicator
    loadingIndicator.style.display = 'block';

    // Submit the form programmatically
    summaryForm.submit();
  });
</script>

<script>
setTimeout(() => {
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(alert => alert.style.display = 'none');
}, 3000);
</script>
{% endblock %}
